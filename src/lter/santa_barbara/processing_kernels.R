source('src/lter/santa_barbara/domain_helpers.R')
#retrieval kernels ####

#precipitation: STATUS=READY
#. handle_errors
process_0_5010 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5016 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5026 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4004 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5001 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5004 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5005 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5006 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5007 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5008 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5011<- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5014 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5015 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5017 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5018 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5019 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5020 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5021 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5022 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5024 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5027 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5028 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4003 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5002 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5003 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5009 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5012 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5023 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5025 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_5013 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_33 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4001 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4002 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4006 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4009 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4010 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4011 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4012 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4007 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4008 <- retrieve_santa_barbara

#precipitation: STATUS=READY
#. handle_errors
process_0_4005 <- retrieve_santa_barbara

#stream_chemistry: STATUS=READY
#. handle_errors
process_0_6 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3006 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3009 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3010 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3011 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3001 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3003 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3007 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3008 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3013 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3015 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3016 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3005 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3002 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3004 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3012 <- retrieve_santa_barbara

#discharge: STATUS=READY
#. handle_errors
process_0_3014 <- retrieve_santa_barbara

#munge kernels ####

#precipitation: STATUS=READY
#. handle_errors
process_1_5010 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5016 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5026 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4004 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5001 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5004 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5005 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5006 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5007 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5008 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5011<- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5014 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5015 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5017 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5018 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5019 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5020 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5021 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5022 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5024 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5027 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5028 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4003 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5002 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5003 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5009 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5012 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5023 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5025 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_5013 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_33 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4001 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4002 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4006 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4009 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4010 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4011 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4012 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4007 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4008 <- munge_santa_barbara_precip

#precipitation: STATUS=READY
#. handle_errors
process_1_4005 <- munge_santa_barbara_precip

#stream_chemistry: STATUS=READY
#. handle_errors
process_1_6 <- function(network, domain, prodname_ms, site_name,
                        component){

    rawfile1 = glue('data/{n}/{d}/raw/{p}/{s}/{c}.csv',
                    n = network,
                    d = domain,
                    p = prodname_ms,
                    s = site_name,
                    c = component)

    d <- ms_read_raw_csv(filepath = rawfile1,
                         datetime_cols = list('timestamp_local' = '%Y-%m-%dT%H:%M:%S'),
                         datetime_tz = 'US/Pacific',
                         site_name_col = 'site_code',
                         data_cols =  c('nh4_uM' = 'NH4',
                                        'no3_uM' = 'NO3_NO2',
                                        'po4_uM' = 'PO4',
                                        'tdn_uM' = 'TDN',
                                        'tdp_uM' = 'TDP',
                                        'tpc_uM' = 'TPC',
                                        'tpn_uM' = 'TPN',
                                        'tpp_uM' = 'TPP',
                                        'tss_mgperLiter' = 'TSS',
                                        'spec_cond_uSpercm' = 'spCond'),
                         data_col_pattern = '#V#',
                         set_to_NA =  c('-999', '-999.00', '-999.0'),
                         is_sensor = FALSE)

    d <- ms_cast_and_reflag(d,
                            varflag_col_pattern = NA)

    d <- ms_conversions(d,
                        convert_units_from = c('NH4' = 'umol/l',
                                               'NO3_NO2' = 'umol/l',
                                               'PO4' = 'umol/l',
                                               'TDN' = 'umol/l',
                                               'TDP' = 'umol/l',
                                               'TPC' = 'umol/l',
                                               'TPN' = 'umol/l',
                                               'TPP' = 'umol/l'),
                        convert_units_to = c('NH4' = 'mg/l',
                                             'NO3_NO2' = 'mg/l',
                                             'PO4' = 'mg/l',
                                             'TDN' = 'mg/l',
                                             'TDP' = 'mg/l',
                                             'TPC' = 'mg/l',
                                             'TPN' = 'mg/l',
                                             'TPP' = 'mg/l'))

    d <- carry_uncertainty(d,
                           network = network,
                           domain = domain,
                           prodname_ms = prodname_ms)

    d <- synchronize_timestep(d)

    d <- apply_detection_limit_t(d, network, domain, prodname_ms)

    return(d)
}

#discharge: STATUS=READY
#. handle_errors
process_1_3006 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3009 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3010 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3011 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3001 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3003 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3007 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3008 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3013 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3015 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3016 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3005 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3002 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3004 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3012 <- munge_santa_barbara_discharge

#discharge: STATUS=READY
#. handle_errors
process_1_3014 <- munge_santa_barbara_discharge

#derive kernels ####

#usgs_discharge: STATUS=READY
#. handle_errors
process_2_ms006 <- function(network, domain, prodname_ms) {

    pull_usgs_discharge(network = network,
                        domain = domain,
                        prodname_ms = prodname_ms,
                        sites = c('SP02' = '11120520',
                                  'MC06' = '11119745'),
                        time_step = 'sub_daily')

    return()
}

#discharge: STATUS=READY
#. handle_errors
process_2_ms001 <- function(network, domain, prodname_ms) {

    combine_products(network = network,
                     domain = domain,
                     prodname_ms = prodname_ms,
                     input_prodname_ms = c('discharge__3006',
                                           'discharge__3009',
                                           'discharge__3010',
                                           'discharge__3011',
                                           'discharge__3001',
                                           'discharge__3003',
                                           'discharge__3007',
                                           'discharge__3008',
                                           'discharge__3013',
                                           'discharge__3015',
                                           'discharge__3016',
                                           'discharge__3005',
                                           'discharge__3002',
                                           'discharge__3004',
                                           'discharge__3012',
                                           'discharge__3014',
                                           'usgs_discharge__ms006'))

    return()
}

#precip_gauge_locations: STATUS=READY
#. handle_errors
process_2_ms004 <- precip_gauge_from_site_data

#stream_gauge_locations: STATUS=READY
#. handle_errors
process_2_ms007 <- stream_gauge_from_site_data

# #precipitation: STATUS=OBSOLETE
# #. handle_errors
process_2_ms002 <- function(network, domain, prodname_ms) {

    combine_products(network = network,
                     domain = domain,
                     prodname_ms = prodname_ms,
                     input_prodname_ms = c('precipitation__5010',
                                           'precipitation__5016',
                                           'precipitation__5026',
                                           'precipitation__4004',
                                           'precipitation__5001',
                                           'precipitation__5004',
                                           'precipitation__5005',
                                           'precipitation__5006',
                                           'precipitation__5007',
                                           'precipitation__5008',
                                           'precipitation__5011',
                                           'precipitation__5014',
                                           'precipitation__5015',
                                           'precipitation__5017',
                                           'precipitation__5018',
                                           'precipitation__5019',
                                           'precipitation__5020',
                                           'precipitation__5021',
                                           'precipitation__5022',
                                           'precipitation__5024',
                                           'precipitation__5027',
                                           'precipitation__5028',
                                           'precipitation__4003',
                                           'precipitation__5002',
                                           'precipitation__5003',
                                           'precipitation__5009',
                                           'precipitation__5012',
                                           'precipitation__5023',
                                           'precipitation__5025',
                                           'precipitation__5013',
                                           'precipitation__4001',
                                           'precipitation__4002',
                                           'precipitation__4006',
                                           'precipitation__4009',
                                           'precipitation__4010',
                                           'precipitation__4011',
                                           'precipitation__4012',
                                           'precipitation__4007',
                                           'precipitation__4008',
                                           'precipitation__4005'))

    return()
}

#precip_pchem_pflux: STATUS=READY
#. handle_errors
process_2_ms003 <- derive_precip_pchem_pflux

#stream_flux_inst: STATUS=READY
#. handle_errors
process_2_ms005 <- derive_stream_flux
